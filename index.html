<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="styles.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">
  <title>Document</title>
</head>
<body>
  <header>
    <div class="app_header">
      <div class="app_auth_buttons">
        <button>
          <a href="#">Login</a> 
        </button>                 
        |
        <button>
          <a href="#">Register</a> 
        </button>        
        
      </div>      
    </div>
  </header>

  <main class="app_main">
    <div class="app_main_grid">

      <article class="app_card" draggable="true">
        <section class="card_category">Programming 1</section>
        <section class="card_to_do_section">
          <ul>
            <li>Learn SQLAlchemy</li>
            <li>Learn FastAPI</li>
            <li>Learn React</li>
          </ul>
        </section>
        <section class="app_card_new_task_section">
          <button class="app_card_new_task_btn">+ Add New Task</button>
        </section>
      </article>

      <article class="app_card" draggable="true">
        <section class="card_category">Programming 2</section>
        <section class="card_to_do_section">
          <ul>
            <li>Learn SQLAlchemy</li>
            <li>Learn FastAPI</li>
            <li>Learn React</li>
          </ul>
        </section>
        <section class="app_card_new_task_section">
          <button class="app_card_new_task_btn">+ Add New Task</button>
        </section>
      </article>

      <article class="app_card" draggable="true">
        <section class="card_category">Programming 3</section>
        <section class="card_to_do_section">
          <ul>
            <li>Learn SQLAlchemy</li>
            <li>Learn FastAPI</li>
            <li>Learn React</li>
          </ul>
        </section>
        <section class="app_card_new_task_section">
          <button class="app_card_new_task_btn">+ Add New Task</button>
        </section>
      </article>

      <article class="app_card" draggable="true">
        <section class="card_category">Programming 4</section>
        <section class="card_to_do_section">
          <ul>
            <li>Learn SQLAlchemy</li>
            <li>Learn FastAPI</li>
            <li>Learn React</li>
          </ul>
        </section>
        <section class="app_card_new_task_section">
          <button class="app_card_new_task_btn">+ Add New Task</button>
        </section>
      </article>

      <article class="app_card" draggable="true">
        <section class="card_category">Programming 5</section>
        <section class="card_to_do_section">
          <ul>
            <li>Learn SQLAlchemy</li>
            <li>Learn FastAPI</li>
            <li>Learn React</li>
          </ul>
        </section>
        <section class="app_card_new_task_section">
          <button class="app_card_new_task_btn">+ Add New Task</button>
        </section>
      </article>

      <article class="app_card" draggable="true">
        <section class="card_category">Programming 6</section>
        <section class="card_to_do_section">
          <ul>
            <li>Learn SQLAlchemy</li>
            <li>Learn FastAPI</li>
            <li>Learn React</li>
          </ul>
        </section>
        <section class="app_card_new_task_section">
          <button class="app_card_new_task_btn">+ Add New Task</button>
        </section>
      </article>

      <article class="app_card" draggable="true">
        <section class="card_category">Programming 6</section>
        <section class="card_to_do_section">
          <ul>
            <li>Learn SQLAlchemy</li>
            <li>Learn FastAPI</li>
            <li>Learn React</li>
          </ul>
        </section>
        <section class="app_card_new_task_section">
          <button class="app_card_new_task_btn">+ Add New Task</button>
        </section>
      </article>

      <article class="app_add_card">
        <section>
          <button>
            <span class="plus">+</span> 
            <br> Add New Category
          </button>
        </section>
      </article>

    </div>
  </main>

  <footer>
    <div class="app_footer">
      &copy; Alex Levitskiy 2025
    </div>
  </footer>
</body>
<script>
const grid = document.querySelector('.app_main_grid');
let draggedEl = null;

let isAnimating = false;

function animateFlip(elements, beforeRects) {
  if (isAnimating) return; // ðŸš« ÐŸÑ€Ð¾Ð¿ÑƒÑÐºÐ°ÐµÐ¼, ÐµÑÐ»Ð¸ ÑƒÐ¶Ðµ Ð¸Ð´Ñ‘Ñ‚ Ð°Ð½Ð¸Ð¼Ð°Ñ†Ð¸Ñ

  const animations = [];

  elements.forEach(el => {
    const first = beforeRects.get(el);
    const last = el.getBoundingClientRect();

    if (!first) return;

    const dx = first.left - last.left;
    const dy = first.top - last.top;

    if (dx === 0 && dy === 0) return; // âœ‹ ÐÐµÑ‚ ÑÐ¼ÐµÑ‰ÐµÐ½Ð¸Ñ â€” Ð½ÐµÑ‡ÐµÐ³Ð¾ Ð°Ð½Ð¸Ð¼Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ

    const anim = el.animate([
      { transform: `translate(${dx}px, ${dy}px)` },
      { transform: 'translate(0, 0)' }
    ], {
      duration: 300,
      easing: 'ease'
    });

    animations.push(anim);
  });

  if (animations.length > 0) {
    isAnimating = true;
    Promise.all(animations.map(a => a.finished)).then(() => {
      isAnimating = false;
    });
  }
}






let startX = 0, startY = 0;
let offsetX = 0, offsetY = 0;
let placeholder = null;

grid.addEventListener('mousedown', (e) => {
  const target = e.target.closest('.app_card');
  if (!target) return;

  draggedEl = target;
  const rect = target.getBoundingClientRect();

  startX = e.clientX;
  startY = e.clientY;
  offsetX = e.clientX - rect.left;
  offsetY = e.clientY - rect.top;

  // ÐšÐ»Ð¾Ð½Ð¸Ñ€ÑƒÐµÐ¼ ÑÐ»ÐµÐ¼ÐµÐ½Ñ‚ ÐºÐ°Ðº placeholder
  placeholder = document.createElement('article');


  placeholder.className = 'app_card placeholder';
  const style = getComputedStyle(target);
  placeholder.style.width = style.width;
  placeholder.style.height = style.height;
  

  grid.insertBefore(placeholder, target.nextSibling);

  // ÐŸÐµÑ€ÐµÐ¼ÐµÑ‰Ð°ÐµÐ¼ ÐºÐ°Ñ€Ñ‚Ð¾Ñ‡ÐºÑƒ Ð² body
  draggedEl.classList.add('dragging');
  draggedEl.style.width = `${rect.width}px`;
  draggedEl.style.height = `${rect.height}px`;
  document.body.appendChild(draggedEl);

  moveAt(e.pageX, e.pageY);

  document.addEventListener('mousemove', onMouseMove);
  document.addEventListener('mouseup', onMouseUp);
});

function moveAt(pageX, pageY) {
  draggedEl.style.left = pageX - offsetX + 'px';
  draggedEl.style.top = pageY - offsetY + 'px';
}

let lastOrderRects = new Map();

let animationInProgress = false;

async function onMouseMove(e) {
  if (animationInProgress) return; // Ð½Ðµ Ð¾Ð±Ñ€Ð°Ð±Ð°Ñ‚Ñ‹Ð²Ð°Ñ‚ÑŒ, Ð¿Ð¾ÐºÐ° Ð¸Ð´Ñ‘Ñ‚ Ð°Ð½Ð¸Ð¼Ð°Ñ†Ð¸Ñ

  moveAt(e.pageX, e.pageY);

  const allCards = [...grid.querySelectorAll('.app_card')];
  const cards = allCards.filter(c => c !== placeholder);

  const mouseX = e.clientX;
  const mouseY = e.clientY;

  for (const card of cards) {
    const rect = card.getBoundingClientRect();
    const isInsideY = mouseY > rect.top && mouseY < rect.bottom;
    const isInsideX = mouseX > rect.left && mouseX < rect.right;

    if (isInsideX && isInsideY) {
      const centerX = rect.left + rect.width / 2;
      const currentIndex = allCards.indexOf(placeholder);
      const targetIndex = allCards.indexOf(card);
      const direction = mouseX < centerX ? 'before' : 'after';

      const isSamePosition =
        (direction === 'before' && currentIndex === targetIndex + 1) ||
        (direction === 'after' && currentIndex === targetIndex - 1);

      if (isSamePosition) return;

      // 1. Ð¡Ð¾Ñ…Ñ€Ð°Ð½ÑÐµÐ¼ ÑÑ‚Ð°Ñ€Ñ‹Ðµ Ð¿Ð¾Ð·Ð¸Ñ†Ð¸Ð¸
      const lastRects = new Map();
      cards.forEach(el => lastRects.set(el, el.getBoundingClientRect()));

      // 2. ÐœÐµÐ½ÑÐµÐ¼ DOM
      if (direction === 'before') {
        grid.insertBefore(placeholder, card.nextSibling);
      } else {
        grid.insertBefore(placeholder, card);
      }

      // 3. ÐÐ½Ð¸Ð¼Ð°Ñ†Ð¸Ñ (Ð¾Ð¶Ð¸Ð´Ð°ÐµÐ¼ Ð·Ð°Ð²ÐµÑ€ÑˆÐµÐ½Ð¸Ñ)
      animationInProgress = true;
      const updatedCards = [...grid.querySelectorAll('.app_card')].filter(c => c !== placeholder);
      await animateFlip(updatedCards, lastRects);
      animationInProgress = false;

      break;
    }
  }
}



function onMouseUp() {
  placeholder.replaceWith(draggedEl);

  draggedEl.classList.remove('dragging');
  draggedEl.style = '';

  document.removeEventListener('mousemove', onMouseMove);
  document.removeEventListener('mouseup', onMouseUp);

  draggedEl = null;
}

</script>

</html>